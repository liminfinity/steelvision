APP_PORT        ?= 8501
NGROK_BIN       ?= ngrok
SERVER_ADDRESS  ?= 0.0.0.0

.PHONY: run tunnel all stop

# -------------------------------------------------------------
# Запуск Streamlit-приложения
# -------------------------------------------------------------
run:
	streamlit run app.py \
		--server.port $(APP_PORT) \
		--server.address $(SERVER_ADDRESS)

# -------------------------------------------------------------
# Проброс порта через ngrok
# -------------------------------------------------------------
tunnel:
	$(NGROK_BIN) http $(APP_PORT)

# -------------------------------------------------------------
# Запустить и приложение, и туннель параллельно
# -------------------------------------------------------------
all:
	$(MAKE) -j 2 run tunnel

# -------------------------------------------------------------
# Остановить все процессы streamlit
# -------------------------------------------------------------
stop:
	pkill -f "streamlit run app.py" || true
